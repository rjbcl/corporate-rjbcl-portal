{% extends 'Dashboard/Company/base.html' %}
{% load static %}

{% block title %}Maturity Forecasting Report - {{ company.company_name }}{% endblock %}

{% block extra_css %}
<style>
    .table-striped tbody tr:hover {
        background-color: #f5f8fa;
    }

    /* Loading Spinner */
    .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->

<div id="user-info" data-username="{{ user.username }}" class="d-none"></div>

{% csrf_token %}
<div class="row page-titles mx-0">
    <div class="col-sm-6 p-md-0">
        <div class="welcome-text">
            <h4>Maturity Forecasting Report</h4>
            <p class="mb-0">Generate and analyze policy maturity forecasts</p>
        </div>
    </div>
    <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="javascript:void(0)">Reports</a></li>
            <li class="breadcrumb-item active"><a href="javascript:void(0)">Maturity Forecasting</a></li>
        </ol>
    </div>
</div>

<!-- Report Form Container -->
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <!-- Card Body -->
            <div class="card-body">

                <!-- Report Form -->
                <div class="basic-form">
                    <form id="maturity-report-form">
                        <!-- Date Range Selection -->
                        <div class="form-row">
                            <!-- From Date Column -->
                            <div class="form-group col-md-6">
                                <label>From Date <span class="text-danger">*</span></label>
                                <div class="row">
                                    <div class="col-md-6 mb-6 pe-4 mb-md-0">
                                        <small class="form-text text-muted mb-1 d-block">BS</small>
                                        <input type="text" class="form-control" id="from-date-bs" name="from_date_bs"
                                            placeholder="YYYY-MM-DD">
                                    </div>
                                    <div class="col-md-6 px-4 ">
                                        <small class="form-text text-muted mb-1 d-block">AD</small>
                                        <input type="date" class="form-control" id="from-date-ad" name="from_date_ad"
                                            required>
                                    </div>
                                </div>
                            </div>

                            <!-- To Date Column -->
                            <div class="form-group col-md-6">
                                <label>To Date <span class="text-danger">*</span></label>
                                <div class="row">
                                    <div class="col-md-6 px-4  mb-3 mb-md-0">
                                        <small class="form-text text-muted mb-1 d-block">BS</small>
                                        <input type="text" class="form-control" id="to-date-bs" name="to_date_bs"
                                            placeholder="YYYY-MM-DD">
                                    </div>
                                    <div class="col-md-6 ps-4 ">
                                        <small class="form-text text-muted mb-1 d-block">AD</small>
                                        <input type="date" class="form-control" id="to-date-ad" name="to_date_ad"
                                            required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Group Selection -->
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label>Select Group <span class="text-danger">*</span></label>
                                <select id="group-id" name="group_id" class="form-control py-2 " required>
                                    <option value="">-- Select a Group --</option>
                                    {% for group in groups %}
                                    <option value="{{ group.group_id }}">{{ group.group_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" id="generate-btn">
                                <i class="bi bi-file-earmark-bar-graph"></i> Generate Report
                            </button>
                            <button type="button" class="btn btn-success ml-2" id="download-btn" disabled>
                                <i class="bi bi-download"></i> Download Report
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Report Results Section -->
<div class="row report-results" id="report-results" style="display: none;">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="report-table" class="display table table-striped" style="min-width: 845px">
                        <thead>
                            <tr>
                                <th>Policy No</th>
                                <th>Employee Name</th>
                                <th>Sum Assured</th>
                                <th>Premium</th>
                                <th>Maturity Date</th>
                                <th>Days to Maturity</th>
                                <th>Term</th>
                                <th>Status</th>

                            </tr>
                        </thead>
                        <tbody id="report-tbody">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/date-conversion.js' %}"></script>
<script src="{% static 'js/nepaliFunctions.js' %}" type="text/javascript" charset="UTF-8"></script>
<script src="{% static 'js/dashboard/reports/maturity_forecasting_report.js' %}"></script>
{% endblock %}